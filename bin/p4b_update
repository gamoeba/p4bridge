#!/bin/bash

OPENED=`p4 opened | wc -l`
if [ ! $OPENED -eq 0 ]
then
	echo "open files in perforce, please revert or shelve first"
	exit 1
fi

pushd .
cd $P4BRIDGE_HOME 

if [ $# -gt 0 ]
then
	for repo in $*
	do
		export GIT_DIR=$repo/.git 
		p4b_helperupdate
	done
else
	cat .repos | xargs -L1 echo | gawk '{
			repo=$1
			system("export GIT_DIR="repo"/.git ; p4b_helperupdate")
			}'
fi
popd
repo sync
