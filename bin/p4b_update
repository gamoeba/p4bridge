#!/bin/bash
source p4butils
setdepot

OPENED=`p4 opened 2>/dev/null | wc -l`
if [ ! $OPENED -eq 0 ]
then
	echo "open files in perforce, please revert or shelve first"
	exit 1
fi
CURR_BRANCH=`git rev-parse --abbrev-ref HEAD`
git checkout p4_master && p4b_availchanges `lastp4change` | while read CHG; do p4b_getupdate $CHG; done
git checkout .
git checkout $CURR_BRANCH
